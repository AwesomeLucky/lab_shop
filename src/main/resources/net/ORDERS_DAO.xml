<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.OrdersDao">
    <resultMap type="OrdersVO" id="ordersResultMap">
    	<id column="no" property="number"/>
    	<result column="order_date" property="orderDate"/>
    	<result column="order_now" property="orderNow"/>
    	<result column="user_email" property="userEmail"/>
    	<result column="user_name" property="userName"/>
    	<result column="user_address" property="userAddress"/>
    	<result column="user_postcode" property="userPostcode"/>
    	<result column="goods_no" property="goodsNumber"/>
    	<result column="name" property="goodsName"/>
    	<result column="options" property="goodsOptions"/>
    	<result column="manufacturer" property="manufacturer"/>
    	<result column="price" property="goodsPrice"/>
    </resultMap>

	<select id="selectList" parameterType="map" resultMap="ordersResultMap">
      select orders.no, orders.order_date, orders.user_email, orders.user_name, orders.order_now,
      	orders.goods_no, goods.name, goods.options, goods.manufacturer, goods.price
      from shop_orders as orders inner join shop_goods as goods on orders.goods_no=goods.no
      <if test="keyword != NULL">
      where orders.user_email like #{keyword} or orders.user_name like #{keyword} or orders.no like #{keyword}
      </if>
      <if test="userEmail != NULL">
      where orders.user_email like #{userEmail}
      </if>
      order by orders.no desc
 	  limit #{offset},#{limit} 
    </select>
    
    <delete id="delete" parameterType="map">
      delete from shop_orders where user_email=#{userEmail} and goods_no=#{goodsNumber}
    </delete>
    
    <select id="count" resultType="int">
      select count(*) from shop_orders
    </select>
    
    <select id="countByKeyword" parameterType="String" resultType="int">
      select count(*) from shop_orders
      where user_email like #{keyword} or user_name like #{keyword} or no like #{keyword}
    </select>
</mapper>